apiVersion: monitoring.rhobs/v1
kind: PrometheusRule
metadata:
  name: coo-prometheus-recording-rules
  namespace: appstudio-monitoring
  labels:
      kubernetes.io/part-of: appstudio-federate-ms
      monitoring.rhobs/stack: appstudio-federate-ms
spec:
  groups:
  - name: rules_container_memory_working_set_bytes
    rules:
    - expr: |
        avg by (node,namespace,container) (rate(container_memory_working_set_bytes{job="kubelet", metrics_path="/metrics/cadvisor", image!=""}[5m])
        * on (cluster, namespace, pod) group_left(node) topk by(cluster, namespace, pod) (1,
          max by(cluster, namespace, pod, node) (kube_pod_info{node!=""})
        ))
      record: node_namespace_container:container_memory_working_set_bytes
