apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- spi/
- build-service/
- managed-gitops/
- dora-metrics/
- has/
- jvm-build-service/
- integration/
- migration/
- release/
- performance/
- pipeline-service/
- generic-dashboards/

# Skip applying the grafana operands (integreatly.org) while the grafana operator is being installed.
# See more information about this option, here:
# https://argo-cd.readthedocs.io/en/stable/user-guide/sync-options/#skip-dry-run-for-new-custom-resources-types
commonAnnotations:
  argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true

configurations:
  - cm-dashboard.yaml

# Migration patch from Grafana v4 to v5, should be removed when all projects are migrated
patchesJson6902:
  - target:
      group: integreatly.org
      version: v1alpha1
      kind: GrafanaDashboard
      name: '.*'
    patch: |-
      - op: replace
        path: "/apiVersion"
        value: grafana.integreatly.org/v1beta1
      - op: add
        path: /spec/instanceSelector
        value:
          matchLabels:
            dashboards: "appstudio-grafana"
