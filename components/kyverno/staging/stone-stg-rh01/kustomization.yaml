apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: konflux-kyverno

generators:
  - kyverno-helm-generator.yaml

images:
  - name: reg.kyverno.io/kyverno/kyverno
    newName: quay.io/konflux-ci/kyverno/kyverno
    newTag: 04693a87a136a7600b0c5e65b5694190ee6515e8
  - name: reg.kyverno.io/kyverno/kyvernopre
    newName: quay.io/konflux-ci/kyverno/kyverno-init
    newTag: 04693a87a136a7600b0c5e65b5694190ee6515e8
  - name: reg.kyverno.io/kyverno/background-controller
    newName: quay.io/konflux-ci/kyverno/kyverno-background
    newTag: 04693a87a136a7600b0c5e65b5694190ee6515e8
  - name: reg.kyverno.io/kyverno/cleanup-controller
    newName: quay.io/konflux-ci/kyverno/kyverno-cleanup
    newTag: 04693a87a136a7600b0c5e65b5694190ee6515e8
  - name: reg.kyverno.io/kyverno/kyverno-cli
    newName: quay.io/konflux-ci/kyverno/kyverno-cli
    newTag: 04693a87a136a7600b0c5e65b5694190ee6515e8

# set resources to jobs
patches:
  - path: job_resources.yaml
    target:
      group: batch
      version: v1
      kind: Job
      name: konflux-kyverno-migrate-resources
  - patch: |
      - op: add
        path: /spec/unhealthyPodEvictionPolicy
        value: AlwaysAllow
    target:
      group: policy
      version: v1
      kind: PodDisruptionBudget
      labelSelector: app.kubernetes.io/part-of=konflux-kyverno
