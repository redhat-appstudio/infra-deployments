apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: konflux-kyverno

generators:
  - kyverno-helm-generator.yaml

# set resources to jobs
patches:
  - path: job_resources.yaml
    target:
      group: batch
      version: v1
      kind: Job
      name: konflux-kyverno-migrate-resources
  - patch: |
      - op: add
        path: /spec/unhealthyPodEvictionPolicy
        value: AlwaysAllow
    target:
      group: policy
      version: v1
      kind: PodDisruptionBudget
      labelSelector: app.kubernetes.io/part-of=konflux-kyverno
