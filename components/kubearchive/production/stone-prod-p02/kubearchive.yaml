
apiVersion: v1
kind: Namespace
metadata:
  labels:
    app.kubernetes.io/component: namespace
    app.kubernetes.io/name: kubearchive
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    cert-manager.io/inject-ca-from: kubearchive/kubearchive-operator-certificate
    controller-gen.kubebuilder.io/version: v0.17.3
  name: clusterkubearchiveconfigs.kubearchive.org
spec:
  conversion:
    strategy: Webhook
    webhook:
      clientConfig:
        service:
          name: webhook-service
          namespace: kubearchive
          path: /convert
      conversionReviewVersions:
        - v1
  group: kubearchive.org
  names:
    kind: ClusterKubeArchiveConfig
    listKind: ClusterKubeArchiveConfigList
    plural: clusterkubearchiveconfigs
    shortNames:
      - ckac
      - ckacs
    singular: clusterkubearchiveconfig
  scope: Cluster
  versions:
    - name: v1
      schema:
        openAPIV3Schema:
          description: ClusterKubeArchiveConfig is the Schema for the clusterkubearchiveconfigs API
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: ClusterKubeArchiveConfigSpec defines the desired state of ClusterKubeArchiveConfig
              properties:
                resources:
                  items:
                    properties:
                      archiveOnDelete:
                        type: string
                      archiveWhen:
                        type: string
                      deleteWhen:
                        type: string
                      selector:
                        properties:
                          apiVersion:
                            type: string
                          kind:
                            type: string
                        required:
                          - apiVersion
                          - kind
                        type: object
                    type: object
                  type: array
              required:
                - resources
              type: object
            status:
              description: ClusterKubeArchiveConfigStatus defines the observed state of ClusterKubeArchiveConfig
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    cert-manager.io/inject-ca-from: kubearchive/kubearchive-operator-certificate
    controller-gen.kubebuilder.io/version: v0.17.3
  name: clustervacuumconfigs.kubearchive.org
spec:
  conversion:
    strategy: Webhook
    webhook:
      clientConfig:
        service:
          name: webhook-service
          namespace: kubearchive
          path: /convert
      conversionReviewVersions:
        - v1
  group: kubearchive.org
  names:
    kind: ClusterVacuumConfig
    listKind: ClusterVacuumConfigList
    plural: clustervacuumconfigs
    shortNames:
      - cvc
      - cvcs
    singular: clustervacuumconfig
  scope: Namespaced
  versions:
    - name: v1
      schema:
        openAPIV3Schema:
          description: ClusterVacuumConfig is the Schema for the clustervacuumconfigs API
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: ClusterVacuumConfigSpec defines the desired state of ClusterVacuumConfig resource
              properties:
                namespaces:
                  additionalProperties:
                    properties:
                      resources:
                        items:
                          properties:
                            apiVersion:
                              type: string
                            kind:
                              type: string
                          required:
                            - apiVersion
                            - kind
                          type: object
                        type: array
                    type: object
                  type: object
              type: object
            status:
              description: ClusterVacuumConfigStatus defines the observed state of ClusterVacuumConfig resource
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    cert-manager.io/inject-ca-from: kubearchive/kubearchive-operator-certificate
    controller-gen.kubebuilder.io/version: v0.17.3
  name: kubearchiveconfigs.kubearchive.org
spec:
  conversion:
    strategy: Webhook
    webhook:
      clientConfig:
        service:
          name: webhook-service
          namespace: kubearchive
          path: /convert
      conversionReviewVersions:
        - v1
  group: kubearchive.org
  names:
    kind: KubeArchiveConfig
    listKind: KubeArchiveConfigList
    plural: kubearchiveconfigs
    shortNames:
      - kac
      - kacs
    singular: kubearchiveconfig
  scope: Namespaced
  versions:
    - name: v1
      schema:
        openAPIV3Schema:
          description: KubeArchiveConfig is the Schema for the kubearchiveconfigs API
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: KubeArchiveConfigSpec defines the desired state of KubeArchiveConfig
              properties:
                resources:
                  items:
                    properties:
                      archiveOnDelete:
                        type: string
                      archiveWhen:
                        type: string
                      deleteWhen:
                        type: string
                      selector:
                        properties:
                          apiVersion:
                            type: string
                          kind:
                            type: string
                        required:
                          - apiVersion
                          - kind
                        type: object
                    type: object
                  type: array
              required:
                - resources
              type: object
            status:
              description: KubeArchiveConfigStatus defines the observed state of KubeArchiveConfig
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    cert-manager.io/inject-ca-from: kubearchive/kubearchive-operator-certificate
    controller-gen.kubebuilder.io/version: v0.17.3
  name: namespacevacuumconfigs.kubearchive.org
spec:
  conversion:
    strategy: Webhook
    webhook:
      clientConfig:
        service:
          name: webhook-service
          namespace: kubearchive
          path: /convert
      conversionReviewVersions:
        - v1
  group: kubearchive.org
  names:
    kind: NamespaceVacuumConfig
    listKind: NamespaceVacuumConfigList
    plural: namespacevacuumconfigs
    shortNames:
      - nvc
      - nvcs
    singular: namespacevacuumconfig
  scope: Namespaced
  versions:
    - name: v1
      schema:
        openAPIV3Schema:
          description: NamespaceVacuumConfig is the Schema for the namespacevacuumconfigs API
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: VacuumListSpec defines the desired state of VacuumList resource
              properties:
                resources:
                  items:
                    properties:
                      apiVersion:
                        type: string
                      kind:
                        type: string
                    required:
                      - apiVersion
                      - kind
                    type: object
                  type: array
              type: object
            status:
              description: NamespaceVacuumConfigStatus defines the observed state of NamespaceVacuumConfig resource
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    cert-manager.io/inject-ca-from: kubearchive/kubearchive-operator-certificate
    controller-gen.kubebuilder.io/version: v0.17.3
  name: sinkfilters.kubearchive.org
spec:
  conversion:
    strategy: Webhook
    webhook:
      clientConfig:
        service:
          name: webhook-service
          namespace: kubearchive
          path: /convert
      conversionReviewVersions:
        - v1
  group: kubearchive.org
  names:
    kind: SinkFilter
    listKind: SinkFilterList
    plural: sinkfilters
    shortNames:
      - sf
      - sfs
    singular: sinkfilter
  scope: Namespaced
  versions:
    - name: v1
      schema:
        openAPIV3Schema:
          description: SinkFilter is the Schema for the sinkfilters API
          properties:
            apiVersion:
              description: |-
                APIVersion defines the versioned schema of this representation of an object.
                Servers should convert recognized schemas to the latest internal value, and
                may reject unrecognized values.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
              type: string
            kind:
              description: |-
                Kind is a string value representing the REST resource this object represents.
                Servers may infer this from the endpoint the client submits requests to.
                Cannot be updated.
                In CamelCase.
                More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
              type: string
            metadata:
              type: object
            spec:
              description: SinkFilterSpec defines the desired state of SinkFilter resource
              properties:
                namespaces:
                  additionalProperties:
                    items:
                      properties:
                        archiveOnDelete:
                          type: string
                        archiveWhen:
                          type: string
                        deleteWhen:
                          type: string
                        selector:
                          properties:
                            apiVersion:
                              type: string
                            kind:
                              type: string
                          required:
                            - apiVersion
                            - kind
                          type: object
                      type: object
                    type: array
                  type: object
              required:
                - namespaces
              type: object
            status:
              description: SinkFilterStatus defines the observed state of SinkFilter resource
              type: object
          type: object
      served: true
      storage: true
      subresources:
        status: {}
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/component: api-server
    app.kubernetes.io/name: kubearchive-api-server
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-api-server
  namespace: kubearchive
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-vacuum
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-cluster-vacuum
  namespace: kubearchive
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-operator
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-operator
  namespace: kubearchive
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/component: sink
    app.kubernetes.io/name: kubearchive-sink
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-sink
  namespace: kubearchive
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-vacuum
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-cluster-vacuum
  namespace: kubearchive
rules:
  - apiGroups:
      - kubearchive.org
    resources:
      - sinkfilters
      - clustervacuumconfigs
    verbs:
      - get
      - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-operator-leader-election
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-operator-leader-election
  namespace: kubearchive
rules:
  - apiGroups:
      - ""
    resources:
      - configmaps
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
      - delete
  - apiGroups:
      - coordination.k8s.io
    resources:
      - leases
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
      - delete
  - apiGroups:
      - ""
    resources:
      - events
    verbs:
      - create
      - patch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    app.kubernetes.io/component: sink
    app.kubernetes.io/name: kubearchive-sink-watch
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-sink-watch
  namespace: kubearchive
rules:
  - apiGroups:
      - kubearchive.org
    resources:
      - sinkfilters
    verbs:
      - get
      - list
      - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-vacuum
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: clusterkubearchiveconfig-read
rules:
  - apiGroups:
      - kubearchive.org
    resources:
      - clusterkubearchiveconfigs
    verbs:
      - get
      - list
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/component: api-server
    app.kubernetes.io/name: kubearchive-api-server
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-api-server
rules:
  - apiGroups:
      - authorization.k8s.io
      - authentication.k8s.io
    resources:
      - subjectaccessreviews
      - tokenreviews
    verbs:
      - create
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/name: kubearchive-edit
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
    rbac.authorization.k8s.io/aggregate-to-edit: "true"
  name: kubearchive-edit
rules:
  - apiGroups:
      - kubearchive.org
    resources:
      - '*'
    verbs:
      - create
      - update
      - patch
      - delete
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: kubearchive-operator
rules:
  - apiGroups:
      - ""
    resources:
      - namespaces
    verbs:
      - get
      - list
      - update
      - watch
  - apiGroups:
      - ""
    resources:
      - serviceaccounts
    verbs:
      - create
      - delete
      - get
      - list
      - update
      - watch
  - apiGroups:
      - kubearchive.org
    resources:
      - clusterkubearchiveconfigs
      - clustervacuums
      - kubearchiveconfigs
      - namespacevacuums
      - sinkfilters
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
  - apiGroups:
      - kubearchive.org
    resources:
      - clusterkubearchiveconfigs/finalizers
      - kubearchiveconfigs/finalizers
      - sinkfilters/finalizers
    verbs:
      - update
  - apiGroups:
      - kubearchive.org
    resources:
      - clusterkubearchiveconfigs/status
      - kubearchiveconfigs/status
      - sinkfilters/status
    verbs:
      - get
      - patch
      - update
  - apiGroups:
      - rbac.authorization.k8s.io
    resources:
      - clusterrolebindings
      - clusterroles
    verbs:
      - bind
      - create
      - delete
      - escalate
      - get
      - list
      - patch
      - update
      - watch
  - apiGroups:
      - rbac.authorization.k8s.io
    resources:
      - rolebindings
      - roles
    verbs:
      - bind
      - create
      - delete
      - escalate
      - get
      - list
      - update
      - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-operator-config-editor
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-operator-config-editor
rules:
  - apiGroups:
      - kubearchive.org
    resources:
      - kubearchiveconfigs
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - update
      - watch
  - apiGroups:
      - kubearchive.org
    resources:
      - kubearchiveconfigs/status
    verbs:
      - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-operator-config-viewer
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-operator-config-viewer
rules:
  - apiGroups:
      - kubearchive.org
    resources:
      - kubearchiveconfigs
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - kubearchive.org
    resources:
      - kubearchiveconfigs/status
    verbs:
      - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/name: kubearchive-view
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
    rbac.authorization.k8s.io/aggregate-to-view: "true"
  name: kubearchive-view
rules:
  - apiGroups:
      - kubearchive.org
    resources:
      - '*'
    verbs:
      - get
      - list
      - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-vacuum
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-cluster-vacuum
  namespace: kubearchive
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: kubearchive-cluster-vacuum
subjects:
  - kind: ServiceAccount
    name: kubearchive-cluster-vacuum
    namespace: kubearchive
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-operator-leader-election
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-operator-leader-election
  namespace: kubearchive
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: kubearchive-operator-leader-election
subjects:
  - kind: ServiceAccount
    name: kubearchive-operator
    namespace: kubearchive
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app.kubernetes.io/component: sink
    app.kubernetes.io/name: kubearchive-sink-watch
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-sink-watch
  namespace: kubearchive
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: kubearchive-sink-watch
subjects:
  - kind: ServiceAccount
    name: kubearchive-sink
    namespace: kubearchive
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-vacuum
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: clusterkubearchiveconfig-read
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: clusterkubearchiveconfig-read
subjects:
  - kind: ServiceAccount
    name: kubearchive-cluster-vacuum
    namespace: kubearchive
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app.kubernetes.io/component: api-server
    app.kubernetes.io/name: kubearchive-api-server
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-api-server
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kubearchive-api-server
subjects:
  - kind: ServiceAccount
    name: kubearchive-api-server
    namespace: kubearchive
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-operator
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-operator
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kubearchive-operator
subjects:
  - kind: ServiceAccount
    name: kubearchive-operator
    namespace: kubearchive
---
apiVersion: v1
data: null
kind: ConfigMap
metadata:
  labels:
    app.kubernetes.io/component: logging
    app.kubernetes.io/name: kubearchive-logging
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-logging
  namespace: kubearchive
---
apiVersion: v1
data:
  DATABASE_DB: a3ViZWFyY2hpdmU=
  DATABASE_KIND: cG9zdGdyZXNxbA==
  DATABASE_PASSWORD: RGF0YWJhczNQYXNzdzByZA==
  DATABASE_PORT: NTQzMg==
  DATABASE_URL: a3ViZWFyY2hpdmUtcncucG9zdGdyZXNxbC5zdmMuY2x1c3Rlci5sb2NhbA==
  DATABASE_USER: a3ViZWFyY2hpdmU=
kind: Secret
metadata:
  labels:
    app.kubernetes.io/component: database
    app.kubernetes.io/name: kubearchive-database-credentials
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-database-credentials
  namespace: kubearchive
type: Opaque
---
apiVersion: v1
data:
  Authorization: QmFzaWMgWVdSdGFXNDZjR0Z6YzNkdmNtUT0=
kind: Secret
metadata:
  labels:
    app.kubernetes.io/component: logging
    app.kubernetes.io/name: kubearchive-logging
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-logging
  namespace: kubearchive
type: Opaque
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/component: api-server
    app.kubernetes.io/name: kubearchive-api-server
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-api-server
  namespace: kubearchive
spec:
  ports:
    - name: server
      port: 8081
      protocol: TCP
      targetPort: 8081
  selector:
    app: kubearchive-api-server
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-operator-webhooks
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-operator-webhooks
  namespace: kubearchive
spec:
  ports:
    - name: webhook-server
      port: 443
      protocol: TCP
      targetPort: 9443
    - name: pprof-server
      port: 8082
      protocol: TCP
      targetPort: 8082
  selector:
    control-plane: controller-manager
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/component: sink
    app.kubernetes.io/name: kubearchive-sink
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-sink
  namespace: kubearchive
spec:
  ports:
    - port: 80
      protocol: TCP
      targetPort: 8080
  selector:
    app: kubearchive-sink
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: api-server
    app.kubernetes.io/name: kubearchive-api-server
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-api-server
  namespace: kubearchive
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kubearchive-api-server
  template:
    metadata:
      labels:
        app: kubearchive-api-server
    spec:
      containers:
        - env:
            - name: KUBEARCHIVE_ENABLE_PPROF
              value: "true"
            - name: LOG_LEVEL
              value: INFO
            - name: KLOG_LEVEL
              value: "0"
            - name: GIN_MODE
              value: release
            - name: KUBEARCHIVE_OTEL_MODE
              value: disabled
            - name: OTEL_EXPORTER_OTLP_ENDPOINT
              value: ""
            - name: KUBEARCHIVE_OTLP_SEND_LOGS
              value: "false"
            - name: OTEL_GO_X_DEPRECATED_RUNTIME_METRICS
              value: "false"
            - name: GOMEMLIMIT
              valueFrom:
                resourceFieldRef:
                  resource: limits.memory
            - name: GOMAXPROCS
              valueFrom:
                resourceFieldRef:
                  resource: limits.cpu
            - name: CACHE_EXPIRATION_AUTHORIZED
              value: 10m
            - name: CACHE_EXPIRATION_UNAUTHORIZED
              value: 1m
            - name: KUBEARCHIVE_LOGGING_DIR
              value: /data/logging
            - name: AUTH_IMPERSONATE
              value: "false"
          envFrom:
            - secretRef:
                name: kubearchive-database-credentials
          image: quay.io/kubearchive/api:workqueue-0f951cc@sha256:0adfa205fe430751e476ff7e4e2888a4e8d37525f7e0aa080f6ecedc5aa4e0f3
          livenessProbe:
            httpGet:
              path: /livez
              port: 8081
              scheme: HTTPS
          name: kubearchive-api-server
          ports:
            - containerPort: 8081
              name: server
              protocol: TCP
            - containerPort: 8888
              name: pprof
              protocol: TCP
          readinessProbe:
            httpGet:
              path: /readyz
              port: 8081
              scheme: HTTPS
          resources:
            limits:
              cpu: 700m
              memory: 256Mi
            requests:
              cpu: 200m
              memory: 230Mi
          volumeMounts:
            - mountPath: /etc/kubearchive/ssl/
              name: tls-secret
              readOnly: true
            - mountPath: /data/logging
              name: logging-secret
      serviceAccountName: kubearchive-api-server
      volumes:
        - name: tls-secret
          secret:
            secretName: kubearchive-api-server-tls
        - name: logging-secret
          secret:
            secretName: kubearchive-logging
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-operator
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-operator
  namespace: kubearchive
spec:
  replicas: 1
  selector:
    matchLabels:
      control-plane: controller-manager
  template:
    metadata:
      annotations:
        kubectl.kubernetes.io/default-container: manager
      labels:
        control-plane: controller-manager
    spec:
      containers:
        - args:
            - --health-probe-bind-address=:8081
            - --leader-elect
          env:
            - name: KUBEARCHIVE_ENABLE_PPROF
              value: "true"
            - name: LOG_LEVEL
              value: INFO
            - name: KLOG_LEVEL
              value: "0"
            - name: KUBEARCHIVE_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: KUBEARCHIVE_OTEL_MODE
              value: disabled
            - name: OTEL_EXPORTER_OTLP_ENDPOINT
              value: ""
            - name: KUBEARCHIVE_OTLP_SEND_LOGS
              value: "false"
            - name: OTEL_GO_X_DEPRECATED_RUNTIME_METRICS
              value: "false"
            - name: GOMEMLIMIT
              valueFrom:
                resourceFieldRef:
                  resource: limits.memory
            - name: GOMAXPROCS
              valueFrom:
                resourceFieldRef:
                  resource: limits.cpu
          image: quay.io/kubearchive/operator:workqueue-0f951cc@sha256:159472a1af323b78bf0e302b2528efc240e41539e25c79800827043d62ae9f65
          livenessProbe:
            httpGet:
              path: /healthz
              port: 8081
            initialDelaySeconds: 15
            periodSeconds: 20
          name: manager
          ports:
            - containerPort: 9443
              name: webhook-server
              protocol: TCP
            - containerPort: 8888
              name: pprof-server
              protocol: TCP
          readinessProbe:
            httpGet:
              path: /readyz
              port: 8081
            initialDelaySeconds: 5
            periodSeconds: 10
          resources:
            limits:
              cpu: 500m
              memory: 128Mi
            requests:
              cpu: 10m
              memory: 64Mi
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
                - ALL
          volumeMounts:
            - mountPath: /tmp/k8s-webhook-server/serving-certs
              name: cert
              readOnly: true
      securityContext:
        runAsNonRoot: true
      serviceAccountName: kubearchive-operator
      terminationGracePeriodSeconds: 10
      volumes:
        - name: cert
          secret:
            defaultMode: 420
            secretName: kubearchive-operator-tls
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: sink
    app.kubernetes.io/name: kubearchive-sink
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-sink
  namespace: kubearchive
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kubearchive-sink
  template:
    metadata:
      labels:
        app: kubearchive-sink
    spec:
      containers:
        - env:
            - name: KUBEARCHIVE_ENABLE_PPROF
              value: "true"
            - name: GIN_MODE
              value: release
            - name: LOG_LEVEL
              value: INFO
            - name: KLOG_LEVEL
              value: "0"
            - name: KUBEARCHIVE_OTEL_MODE
              value: disabled
            - name: OTEL_EXPORTER_OTLP_ENDPOINT
              value: ""
            - name: KUBEARCHIVE_OTLP_SEND_LOGS
              value: "false"
            - name: OTEL_GO_X_DEPRECATED_RUNTIME_METRICS
              value: "false"
            - name: GOMEMLIMIT
              valueFrom:
                resourceFieldRef:
                  resource: limits.memory
            - name: GOMAXPROCS
              valueFrom:
                resourceFieldRef:
                  resource: limits.cpu
            - name: KUBEARCHIVE_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: KUBEARCHIVE_LOGGING_DIR
              value: /data/logging
          envFrom:
            - secretRef:
                name: kubearchive-database-credentials
          image: quay.io/kubearchive/sink:workqueue-0f951cc@sha256:0de40b70a3ac186a32da79bb11037a79e57629a63e1b4a259b426189e1ee3d58
          livenessProbe:
            httpGet:
              path: /livez
              port: 8080
          name: kubearchive-sink
          ports:
            - containerPort: 8080
              name: sink
              protocol: TCP
            - containerPort: 8888
              name: pprof
              protocol: TCP
          readinessProbe:
            httpGet:
              path: /readyz
              port: 8080
            timeoutSeconds: 4
          resources:
            limits:
              cpu: 200m
              memory: 256Mi
            requests:
              cpu: 200m
              memory: 230Mi
          volumeMounts:
            - mountPath: /data/logging
              name: logging-config
      serviceAccountName: kubearchive-sink
      volumes:
        - configMap:
            name: kubearchive-logging
          name: logging-config
---
apiVersion: batch/v1
kind: CronJob
metadata:
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-vacuum
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: cluster-vacuum
  namespace: kubearchive
spec:
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - args:
                - --type
                - cluster
                - --config
                - cluster-vacuum
              command:
                - /ko-app/vacuum
              env:
                - name: KUBEARCHIVE_NAMESPACE
                  valueFrom:
                    fieldRef:
                      fieldPath: metadata.namespace
              image: quay.io/kubearchive/vacuum:workqueue-0f951cc@sha256:f6b21d9a46c8cdb2c53d010efcde398cf0e3aeb26416e416a69d5583855a0c2e
              name: vacuum
          restartPolicy: Never
          serviceAccount: kubearchive-cluster-vacuum
  schedule: '* */3 * * *'
  suspend: true
---
apiVersion: batch/v1
kind: Job
metadata:
  labels:
    app.kubernetes.io/component: kubearchive
    app.kubernetes.io/name: kubearchive-schema-migration
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-schema-migration
  namespace: kubearchive
spec:
  backoffLimit: 4
  parallelism: 1
  suspend: true
  template:
    spec:
      containers:
        - args:
            - set -o errexit; git clone https://github.com/kubearchive/kubearchive --depth=1 --branch=${KUBEARCHIVE_VERSION} /tmp/kubearchive; cd /tmp/kubearchive; export QUOTED_PASSWORD=$(python3 -c "import urllib.parse; print(urllib.parse.quote('${DATABASE_PASSWORD}', ''))"); curl --silent -L https://github.com/golang-migrate/migrate/releases/download/${MIGRATE_VERSION}/migrate.linux-amd64.tar.gz | tar xvz migrate; ./migrate -verbose -path integrations/database/postgresql/migrations/ -database postgresql://${DATABASE_USER}:${QUOTED_PASSWORD}@${DATABASE_URL}:${DATABASE_PORT}/${DATABASE_DB} up
          command:
            - /bin/sh
            - -c
          env:
            - name: KUBEARCHIVE_VERSION
              value: workqueue-0f951cc
            - name: MIGRATE_VERSION
              value: v4.18.3
          envFrom:
            - secretRef:
                name: kubearchive-database-credentials
          image: quay.io/fedora/python-311:20240911
          name: migration
          resources:
            limits:
              cpu: 10m
              memory: 64Mi
            requests:
              cpu: 10m
              memory: 64Mi
          securityContext:
            runAsNonRoot: true
      restartPolicy: Never
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  labels:
    app.kubernetes.io/component: api-server
    app.kubernetes.io/name: kubearchive-api-server-certificate
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-api-server-certificate
  namespace: kubearchive
spec:
  commonName: kubearchive-api-server
  dnsNames:
    - localhost
    - kubearchive-api-server
    - kubearchive-api-server.kubearchive.svc
  duration: 720h
  isCA: false
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: kubearchive
  privateKey:
    algorithm: ECDSA
    size: 256
  renewBefore: 360h
  secretName: kubearchive-api-server-tls
  subject:
    organizations:
      - kubearchive
  usages:
    - digital signature
    - key encipherment
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  labels:
    app.kubernetes.io/component: certs
    app.kubernetes.io/name: kubearchive-ca
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-ca
  namespace: kubearchive
spec:
  commonName: kubearchive-ca-certificate
  isCA: true
  issuerRef:
    group: cert-manager.io
    kind: Issuer
    name: kubearchive-ca
  privateKey:
    algorithm: ECDSA
    size: 256
  secretName: kubearchive-ca
---
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-operator-certificate
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-operator-certificate
  namespace: kubearchive
spec:
  dnsNames:
    - kubearchive-operator-webhooks.kubearchive.svc
    - kubearchive-operator-webhooks.kubearchive.svc.cluster.local
  issuerRef:
    kind: Issuer
    name: kubearchive
  secretName: kubearchive-operator-tls
---
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  labels:
    app.kubernetes.io/component: certs
    app.kubernetes.io/name: kubearchive
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive
  namespace: kubearchive
spec:
  ca:
    secretName: kubearchive-ca
---
apiVersion: cert-manager.io/v1
kind: Issuer
metadata:
  labels:
    app.kubernetes.io/component: certs
    app.kubernetes.io/name: kubearchive-ca
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-ca
  namespace: kubearchive
spec:
  selfSigned: {}
---
apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  annotations:
    cert-manager.io/inject-ca-from: kubearchive/kubearchive-operator-certificate
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-mutating-webhook-configuration
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-mutating-webhook-configuration
webhooks:
  - admissionReviewVersions:
      - v1
    clientConfig:
      service:
        name: kubearchive-operator-webhooks
        namespace: kubearchive
        path: /mutate-kubearchive-org-v1-kubearchiveconfig
    failurePolicy: Fail
    name: mkubearchiveconfig.kb.io
    rules:
      - apiGroups:
          - kubearchive.org
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - kubearchiveconfigs
    sideEffects: None
  - admissionReviewVersions:
      - v1
    clientConfig:
      service:
        name: kubearchive-operator-webhooks
        namespace: kubearchive
        path: /mutate-kubearchive-org-v1-clusterkubearchiveconfig
    failurePolicy: Fail
    name: mclusterkubearchiveconfig.kb.io
    rules:
      - apiGroups:
          - kubearchive.org
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - clusterkubearchiveconfigs
    sideEffects: None
  - admissionReviewVersions:
      - v1
    clientConfig:
      service:
        name: kubearchive-operator-webhooks
        namespace: kubearchive
        path: /mutate-kubearchive-org-v1-sinkfilter
    failurePolicy: Fail
    name: msinkfilter.kb.io
    rules:
      - apiGroups:
          - kubearchive.org
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - sinkfilters
    sideEffects: None
  - admissionReviewVersions:
      - v1
    clientConfig:
      service:
        name: kubearchive-operator-webhooks
        namespace: kubearchive
        path: /mutate-kubearchive-org-v1-namespacevacuumconfig
    failurePolicy: Fail
    name: mnamespacevacuumconfig.kb.io
    rules:
      - apiGroups:
          - kubearchive.org
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - namespacevacuumconfigs
    sideEffects: None
  - admissionReviewVersions:
      - v1
    clientConfig:
      service:
        name: kubearchive-operator-webhooks
        namespace: kubearchive
        path: /mutate-kubearchive-org-v1-clustervacuumconfig
    failurePolicy: Fail
    name: mclustervacuumconfig.kb.io
    rules:
      - apiGroups:
          - kubearchive.org
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - clustervacuumconfigs
    sideEffects: None
---
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  annotations:
    cert-manager.io/inject-ca-from: kubearchive/kubearchive-operator-certificate
  labels:
    app.kubernetes.io/component: operator
    app.kubernetes.io/name: kubearchive-validating-webhook-configuration
    app.kubernetes.io/part-of: kubearchive
    app.kubernetes.io/version: workqueue-0f951cc
  name: kubearchive-validating-webhook-configuration
webhooks:
  - admissionReviewVersions:
      - v1
    clientConfig:
      service:
        name: kubearchive-operator-webhooks
        namespace: kubearchive
        path: /validate-kubearchive-org-v1-kubearchiveconfig
    failurePolicy: Fail
    name: vkubearchiveconfig.kb.io
    rules:
      - apiGroups:
          - kubearchive.org
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - kubearchiveconfigs
    sideEffects: None
  - admissionReviewVersions:
      - v1
    clientConfig:
      service:
        name: kubearchive-operator-webhooks
        namespace: kubearchive
        path: /validate-kubearchive-org-v1-clusterkubearchiveconfig
    failurePolicy: Fail
    name: vclusterkubearchiveconfig.kb.io
    rules:
      - apiGroups:
          - kubearchive.org
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - clusterkubearchiveconfigs
    sideEffects: None
  - admissionReviewVersions:
      - v1
    clientConfig:
      service:
        name: kubearchive-operator-webhooks
        namespace: kubearchive
        path: /validate-kubearchive-org-v1-sinkfilter
    failurePolicy: Fail
    name: vsinkfilter.kb.io
    rules:
      - apiGroups:
          - kubearchive.org
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - sinkfilters
    sideEffects: None
  - admissionReviewVersions:
      - v1
    clientConfig:
      service:
        name: kubearchive-operator-webhooks
        namespace: kubearchive
        path: /validate-kubearchive-org-v1-namespacevacuumconfig
    failurePolicy: Fail
    name: vnamespacevacuumconfig.kb.io
    rules:
      - apiGroups:
          - kubearchive.org
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - namespacevacuumconfigs
    sideEffects: None
  - admissionReviewVersions:
      - v1
    clientConfig:
      service:
        name: kubearchive-operator-webhooks
        namespace: kubearchive
        path: /validate-kubearchive-org-v1-clustervacuumconfig
    failurePolicy: Fail
    name: vclustervacuumconfig.kb.io
    rules:
      - apiGroups:
          - kubearchive.org
        apiVersions:
          - v1
        operations:
          - CREATE
          - UPDATE
        resources:
          - clustervacuumconfigs
    sideEffects: None

---
