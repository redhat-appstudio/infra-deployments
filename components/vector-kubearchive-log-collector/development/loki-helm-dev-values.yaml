---
gateway:
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      memory: 128Mi
  service:
    type: ClusterIP
    port: 80
  # Add startup probe for faster readiness
  readinessProbe:
    initialDelaySeconds: 5   # Reduce from default 15
    periodSeconds: 5         # Check more frequently
    timeoutSeconds: 3
    failureThreshold: 3
    successThreshold: 1


# Service Account configuration to match SCC
serviceAccount:
  create: false
  name: loki

loki:
  commonConfig:
    replication_factor: 1
  storage:
    bucketNames:
      chunks: loki-data
      admin: loki-data
    s3:
      endpoint: http://minio:9000
      region: us-east-1
      s3ForcePathStyle: true
      insecure: true
  storage_config:
    aws:
      s3: s3://loki-chunks
      s3forcepathstyle: true
      bucketnames: loki-data
      region: us-east-1
      endpoint: minio:9000
      insecure: true
  limits_config:
    retention_period: 24h     # Reduce from 744h for development
    ingestion_rate_mb: 5      # Reduce from 10 for development
    ingestion_burst_size_mb: 10  # Reduce from 20
    max_streams_per_user: 0
    max_line_size: 1048576
    reject_old_samples: true
    reject_old_samples_max_age: 6h  # Reduce from 168h
    discover_service_name: []
    volume_enabled: true
    max_global_streams_per_user: 10000  # Reduce from 50000
    max_entries_limit_per_query: 100000
    increment_duplicate_timestamp: true
  ingester:
    chunk_encoding: snappy
    chunk_target_size: 1048576
    chunk_idle_period: 5m
    max_chunk_age: 2h
    chunk_retain_period: 1h
    flush_op_timeout: 10m
  querier:
    # Reduce concurrency for development
    max_concurrent: 2  # Reduce from 4
  pattern_ingester:
    enabled: false

# Distributed components configuration
ingester:
  replicas: 1  # Reduce from 3 to 1 for development
  autoscaling:
    enabled: false  # Disable autoscaling for dev
  zoneAwareReplication:
    enabled: false
  resources:
    requests:
      cpu: 50m  # Reduce from 100m
      memory: 128Mi  # Reduce from 256Mi
    limits:
      memory: 256Mi  # Reduce from 512Mi
  persistence:
    enabled: false  # Disable persistence for dev to avoid storage class issues
    size: 10Gi
  affinity: {}
  podAntiAffinity:
    soft: {}
    hard: {}

querier:
  replicas: 1
  autoscaling:
    enabled: false
  resources:
    requests:
      cpu: 50m  # Keep at 50m
      memory: 128Mi  # Increase from 128Mi for safety
    limits:
      memory: 512Mi  # Restore to 512Mi as it needs more memory
  affinity: {}

queryFrontend:
  replicas: 1
  resources:
    requests:
      cpu: 25m  # Keep CPU low
      memory: 128Mi  # Increase from 64Mi
    limits:
      memory: 256Mi  # Increase from 128Mi to 256Mi

queryScheduler:
  replicas: 1
  resources:
    requests:
      cpu: 25m  # Reduce from 50m
      memory: 32Mi  # Reduce from 64Mi
    limits:
      memory: 64Mi  # Reduce from 128Mi

distributor:
  replicas: 1  # Reduce from 3 to 1 for development
  autoscaling:
    enabled: false  # Disable autoscaling for dev
  maxUnavailable: 1
  resources:
    requests:
      cpu: 50m  # Reduce from 100m
      memory: 128Mi  # Reduce from 256Mi
    limits:
      memory: 256Mi  # Reduce from 512Mi
  affinity: {}

compactor:
  replicas: 1
  retention_enabled: true
  retention_delete_delay: 2h
  retention_delete_worker_count: 150
  resources:
    requests:
      cpu: 50m  # Reduce from 100m
      memory: 64Mi  # Reduce from 128Mi
    limits:
      memory: 128Mi  # Reduce from 256Mi

indexGateway:
  replicas: 1
  maxUnavailable: 0
  resources:
    requests:
      cpu: 50m  # Reduce from 100m
      memory: 128Mi  # Reduce from 256Mi
    limits:
      memory: 256Mi  # Reduce from 512Mi
  affinity: {}

# Disable all cache components to avoid Pending issues in development
chunksCache:
  enabled: false
  replicas: 0

resultsCache:
  enabled: false
  replicas: 0

memcached:
  enabled: false

memcachedResults:
  enabled: false

memcachedChunks:
  enabled: false

memcachedFrontend:
  enabled: false

memcachedIndexQueries:
  enabled: false

memcachedIndexWrites:
  enabled: false

memcachedExporter:
  enabled: false



